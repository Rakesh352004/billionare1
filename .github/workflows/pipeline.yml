name: CI Pipeline  # Name of the workflow

# When to run the workflow
on:
  push:            # Run on code push
    branches:
      - main
  pull_request:     # Also run on pull requests

# The jobs to run
jobs:
  build:              # Job 1: Build/Setup
    runs-on: ubuntu-latest  # Use Ubuntu Linux machine

    steps:             # Step-by-step tasks
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'  # Use Node.js version 20

      - name: Install Dependencies
        run: npm install       # Install project packages

  test:               # Job 2: Test the code
    needs: build       # Wait for build job to finish first
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install bats
        run: npm install -g bats

      - name: Run bats tests
        run: bats         # Run the bats tests
